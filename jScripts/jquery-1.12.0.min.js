let userName = "";
let selectedType = "";
let selectedTastes = []
let checkboxes = "";
let radios = "";

function initForm() {
    userName = document.getElementById("username").value;

    const btn = document.getElementById("submitBtn"); //כפתור לא לחיץ בעת טעינת העמוד
    btn.disabled = true;
    btn.style.opacity = 0.5;

    //בדיקה האם נבחר סוג יין
    radios = document.getElementsByName("wineType");
    let radioChecked = false;
    for (let i = 0; i < radios.length; i++) {
        if (radios[i].checked == true)
        {
            radioChecked = true;
        }
    }

    //בדיקה האם נבחרו טעמי יין
    checkboxes = document.getElementsByName("taste");
    let checkboxChecked = false;
    for (let i = 0; i < checkboxes.length; i++) {
        if (checkboxes[i].checked == true)
        {
            checkboxChecked = true;
        }
    }

    //רק אם כל שדות הטופס מולאו הפתור הופך להיות לחיץ
    if (userName != "" && radioChecked == true && checkboxChecked == true)
    {
        btn.disabled = false;
        btn.style.opacity = 1;
    }
    else
    {
        btn.disabled = true;
        btn.style.opacity = 0.5;
    }

    document.getElementById("result").innerHTML = ""; // איפוס הטקסט אם המשתמש משנה בחירה

    updateImages(); // מעבר לפונקציה שמעדכנת את התמונות לפי הבחירות בזמן אמת
}

function updateImages() {
    radios = document.getElementsByName("wineType"); //קליטה מחדש של סוג היין למקרה והמשתמש שינה את הבחירה 
    for (let i = 0; i < radios.length; i++) {
        if (radios[i].checked == true) {
            selectedType = radios[i].value;
        }
    }

    checkboxes = document.getElementsByName("taste"); //קליטה מחדש של טעמי היין למקרה והמשתמש שינה את הבחירה שלו
    selectedTastes = []; //איפוס המערל של טעמי היינות למראה והמשתמש שינה את הבחירה שלו
    for (let i = 0; i < checkboxes.length; i++) {
        if (checkboxes[i].checked == true)
        {
            selectedTastes[selectedTastes.length] = checkboxes[i].value; //הכנסת הטעמים הנבחרים לתוך המערך
        }
    }

    const allImages = document.getElementsByClassName("wine-image");
    for (let i = 0; i < allImages.length; i++) {
        allImages[i].style.opacity = 0.5; //איפוס שקיפות לכל התמונות
    }

    const tastes = ["dry", "semi", "sweet"]; //יצירת מערך של טעמי היין
    for (let i = 0; i < tastes.length; i++) {
        let imgId = "img-" + selectedType + "-" + tastes[i];
        let img = document.getElementById(imgId); //בחירה של התמונה הרלוונטית בהתאם לבחירות המשתמש

        if (selectedTastes.length == 0) {
            if (img != null) //רק אם נמצא ערך מזהה תואם
            {
                img.style.opacity = 1; // אם אין עדיין טעם נבחר, מראה את כל התמונות של סוג היין
            }
        }
        else
        {
            for (let j = 0; j < selectedTastes.length; j++) {
                if (tastes[i] == selectedTastes[j])
                {
                    if (img != null) //רק אם נמצא ערך מזהה תואם
                    {
                        img.style.opacity = 1; //הצגת התמונות הלרוונטיות לפי הסוג והטעם שהמשתמש בחר
                    }
                }
            }
        }
    }
}

function submitForm() {
    userName = document.getElementById("username").value; //עדכון של השם למקרה והמשתמש שינה אותו בין לחיצות

    let typeText = ""; //בניית טקסט על פי סוג היין
    if (selectedType == "red")
    {
        typeText = "אדום";
    }
    else if (selectedType == "white")
    {
        typeText = "לבן";
    }
    else if (selectedType == "rose")
    {
        typeText = "רוזה";
    }

    let tasteText = ""; // בניית טקסט בהתאם לטעמים שנבחרו
    for (let i = 0; i < selectedTastes.length; i++) {
        if (selectedTastes[i] == "dry")
        {
            tasteText += "יבש";
        }
        else if (selectedTastes[i] == "semi")
        {
            tasteText += "חצי יבש";
        }
        else if (selectedTastes[i] == "sweet")
        {
            tasteText += "מתוק";
        }
        if (i < selectedTastes.length - 1)
        {
            tasteText += ", "; // אם הגענו לטעם האחרון במערך, לא נוסיף פסיק
        }
    }

    document.getElementById("result").innerHTML =
        "שלום " + userName + "!<br>" +
        "בחרת ביין מסוג: " + typeText + "<br>" +
        "העדפות טעם: " + tasteText;
}